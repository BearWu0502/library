"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _ctor=_interopRequireDefault(require("xe-utils/ctor")),_conf=_interopRequireDefault(require("../../conf")),_vXETable=_interopRequireDefault(require("../../v-x-e-table")),_tools=require("../../tools"),_util=require("./util");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,l,t){return l in e?Object.defineProperty(e,l,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[l]=t,e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,l){if(e){if("string"==typeof e)return _arrayLikeToArray(e,l);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,l):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,l){(null==l||l>e.length)&&(l=e.length);for(var t=0,r=new Array(l);t<l;t++)r[t]=e[t];return r}var scrollProcessTimeout,cellType="body";function isOperateMouse(e){return e._isResize||e.lastScrollTime&&Date.now()<e.lastScrollTime+e.delayHover}function renderLine(e,l,t,r,o,n){var a=n.column,i=t.treeOpts,s=t.treeConfig,c=a.slots,d=a.treeNode;return c&&c.line?t.callSlot(c.line,n,e):s&&d&&i.line?[e("div",{class:"vxe-tree--line-wrapper"},[e("div",{class:"vxe-tree--line",style:{height:"".concat((0,_util.calcTreeLine)(n,o),"px"),left:"".concat(r*i.indent+(r?2-(0,_util.getOffsetSize)(t):0)+16,"px")}})])]:[]}function renderColumn(e,l,t,r,o,n,a,i,s,c,d,u,p,f,y,v){var g,m,x=t.$listeners,b=t.afterFullData,h=t.tableData,w=t.height,_=t.columnKey,T=t.overflowX,S=t.scrollXLoad,C=t.scrollYLoad,O=t.highlightCurrentRow,$=t.showOverflow,k=t.isAllOverflow,L=t.align,E=t.currentColumn,I=t.cellClassName,A=t.cellStyle,R=t.mergeList,P=t.spanMethod,B=t.radioOpts,q=t.checkboxOpts,D=t.expandOpts,M=t.treeOpts,H=t.tooltipOpts,j=t.mouseConfig,N=t.editConfig,X=t.editOpts,U=t.editRules,Y=t.validOpts,F=t.editStore,V=t.validStore,W=t.tooltipConfig,z=p.type,K=p.cellRender,G=p.editRender,J=p.align,Q=p.showOverflow,Z=p.className,ee=p.treeNode,le=F.actived,te=H.showAll||H.enabled,re=t.getColumnIndex(p),oe=t.getVTColumnIndex(p),ne=(0,_tools.isEnableConf)(G),ae=a?p.fixed!==a:p.fixed&&T,ie=_ctor.default.isUndefined(Q)||_ctor.default.isNull(Q)?$:Q,se="ellipsis"===ie,ce="title"===ie,de=!0===ie||"tooltip"===ie,ue=ce||de||se,pe={},fe=J||L,ye=V.row===s&&V.column===p,ve=U&&Y.showMessage&&("default"===Y.message?w||1<h.length:"inline"===Y.message),ge={colid:p.id},me=x["cell-mouseenter"],xe=x["cell-mouseleave"],be=G&&N&&"dblclick"===X.trigger,he={$table:t,$seq:r,seq:o,rowid:n,row:s,rowIndex:c,$rowIndex:d,_rowIndex:u,column:p,columnIndex:re,$columnIndex:f,_columnIndex:oe,fixed:a,type:cellType,isHidden:ae,level:i,visibleData:b,data:h,items:v};if(!S&&!C||ue||(se=ue=!0),(ce||de||te||me||W)&&(pe.mouseenter=function(e){isOperateMouse(t)||(ce?_tools.DomTools.updateCellTitle(e.currentTarget,p):(de||te)&&t.triggerBodyTooltipEvent(e,he),me&&t.emitEvent("cell-mouseenter",Object.assign({cell:e.currentTarget},he),e))}),(de||te||xe||W)&&(pe.mouseleave=function(e){isOperateMouse(t)||((de||te)&&t.handleTargetLeaveEvent(e),xe&&t.emitEvent("cell-mouseleave",Object.assign({cell:e.currentTarget},he),e))}),(q.range||j)&&(pe.mousedown=function(e){t.triggerCellMousedownEvent(e,he)}),(O||x["cell-click"]||G&&N||"row"===D.trigger||"cell"===D.trigger||"row"===B.trigger||"radio"===p.type&&"cell"===B.trigger||"row"===q.trigger||"checkbox"===p.type&&"cell"===q.trigger||"row"===M.trigger||p.treeNode&&"cell"===M.trigger)&&(pe.click=function(e){t.triggerCellClickEvent(e,he)}),(be||x["cell-dblclick"])&&(pe.dblclick=function(e){t.triggerCellDBLClickEvent(e,he)}),R.length){var we=(0,_util.mergeBodyMethod)(R,u,oe);if(we){var _e=we.rowspan,Te=we.colspan;if(!_e||!Te)return null;1<_e&&(ge.rowspan=_e),1<Te&&(ge.colspan=Te)}}else if(P){var Se=P(he)||{},Ce=Se.rowspan,Oe=void 0===Ce?1:Ce,$e=Se.colspan,ke=void 0===$e?1:$e;if(!Oe||!ke)return null;1<Oe&&(ge.rowspan=Oe),1<ke&&(ge.colspan=ke)}ae&&R&&(1<ge.colspan||1<ge.rowspan)&&(ae=!1),!ae&&N&&(G||K)&&X.showStatus&&(m=t.isUpdateByRow(s,p.property));var Le=[];return ae&&($?k:$)?Le.push(e("div",{class:["vxe-cell",{"c--title":ce,"c--tooltip":de,"c--ellipsis":se}]})):(Le.push.apply(Le,_toConsumableArray(renderLine(e,l,t,i,v,he)).concat([e("div",{class:["vxe-cell",{"c--title":ce,"c--tooltip":de,"c--ellipsis":se}],attrs:{title:ce?t.getCellLabel(s,p):null}},p.renderCell(e,he))])),ve&&ye&&Le.push(e("div",{class:"vxe-cell--valid",style:V.rule&&V.rule.maxWidth?{width:"".concat(V.rule.maxWidth,"px")}:null},[e("span",{class:"vxe-cell--valid-msg"},V.content)]))),e("td",{class:["vxe-body--column",p.id,(g={},_defineProperty(g,"col--".concat(fe),fe),_defineProperty(g,"col--".concat(z),z),_defineProperty(g,"col--last",f===y.length-1),_defineProperty(g,"col--tree-node",ee),_defineProperty(g,"col--edit",ne),_defineProperty(g,"col--ellipsis",ue),_defineProperty(g,"fixed--hidden",ae),_defineProperty(g,"col--dirty",m),_defineProperty(g,"col--actived",N&&ne&&le.row===s&&(le.column===p||"row"===X.mode)),_defineProperty(g,"col--valid-error",ye),_defineProperty(g,"col--current",E===p),g),_tools.UtilTools.getClass(Z,he),_tools.UtilTools.getClass(I,he)],key:_?p.id:f,attrs:ge,style:A?_ctor.default.isFunction(A)?A(he):A:null,on:pe},Le)}function renderRows(f,y,v,g,m,x,b,h){var w=v.stripe,_=v.rowKey,T=v.highlightHoverRow,S=v.rowClassName,C=v.rowStyle,O=v.showOverflow,$=v.treeConfig,k=v.treeOpts,L=v.treeExpandeds,E=v.scrollYLoad,I=v.scrollYStore,A=v.editStore,R=v.rowExpandeds,P=v.radioOpts,B=v.checkboxOpts,q=v.expandColumn,D=[];return b.forEach(function(t,r){var e={},o=r,n=o+1;E&&(n+=I.startIndex);var a=v.getVTRowIndex(t);o=v.getRowIndex(t),T&&(e.mouseenter=function(e){isOperateMouse(v)||v.triggerHoverEvent(e,{row:t,rowIndex:o})},e.mouseleave=function(){isOperateMouse(v)||v.clearHoverRow()});var i=_tools.UtilTools.getRowid(v,t),l={$table:v,$seq:g,seq:n,rowid:i,fixed:x,type:cellType,level:m,row:t,rowIndex:o,$rowIndex:r};if(D.push(f("tr",{class:["vxe-body--row",{"row--stripe":w&&(v.getVTRowIndex(t)+1)%2==0,"is--new":-1<A.insertList.indexOf(t),"row--radio":P.highlight&&v.selectRow===t,"row--checked":B.highlight&&v.isCheckedByCheckboxRow(t)},S?_ctor.default.isFunction(S)?S(l):S:""],attrs:{rowid:i},style:C?_ctor.default.isFunction(C)?C(l):C:null,key:_||$?i:r,on:e},h.map(function(e,l){return renderColumn(f,y,v,g,n,i,x,m,t,o,r,a,e,l,h,b)}))),q&&R.length&&-1<R.indexOf(t)){var s;$&&(s={paddingLeft:"".concat(m*k.indent+30,"px")});var c=q.showOverflow,d=_ctor.default.isUndefined(c)||_ctor.default.isNull(c)?O:c,u={$table:v,$seq:g,seq:n,column:q,fixed:x,type:cellType,level:m,row:t,rowIndex:o,$rowIndex:r};D.push(f("tr",{class:"vxe-body--expanded-row",key:"expand_".concat(i),style:C?_ctor.default.isFunction(C)?C(u):C:null,on:e},[f("td",{class:["vxe-body--expanded-column",{"fixed--hidden":x,"col--ellipsis":d}],attrs:{colspan:h.length}},[f("div",{class:"vxe-body--expanded-cell",style:s},[q.renderData(f,u)])])]))}if($&&L.length){var p=t[k.children];p&&p.length&&-1<L.indexOf(t)&&D.push.apply(D,_toConsumableArray(renderRows(f,y,v,g?"".concat(g,".").concat(n):"".concat(n),m+1,x,p,h)))}}),D}function syncBodyScroll(e,l,t){(l||t)&&(l&&(l.onscroll=null,l.scrollTop=e),t&&(t.onscroll=null,t.scrollTop=e),clearTimeout(scrollProcessTimeout),scrollProcessTimeout=setTimeout(function(){l&&(l.onscroll=l._onscroll),t&&(t.onscroll=t._onscroll)},300))}var _default={name:"VxeTableBody",props:{tableData:Array,tableColumn:Array,fixedColumn:Array,size:String,fixedType:String},mounted:function(){var e=this.$parent,l=this.$el,t=this.$refs,r=this.fixedType,o=e.elemStore,n="".concat(r||"main","-body-");o["".concat(n,"wrapper")]=l,o["".concat(n,"table")]=t.table,o["".concat(n,"colgroup")]=t.colgroup,o["".concat(n,"list")]=t.tbody,o["".concat(n,"xSpace")]=t.xSpace,o["".concat(n,"ySpace")]=t.ySpace,o["".concat(n,"emptyBlock")]=t.emptyBlock,this.$el.onscroll=this.scrollEvent,this.$el._onscroll=this.scrollEvent},beforeDestroy:function(){this.$el._onscroll=null,this.$el.onscroll=null},render:function(t){var e,l=this._e,r=this.$parent,o=this.fixedColumn,n=this.fixedType,a=r.$scopedSlots,i=r.tId,s=r.tableData,c=r.tableColumn,d=r.showOverflow,u=r.keyboardConfig,p=r.keyboardOpts,f=r.mergeList,y=r.spanMethod,v=r.scrollXLoad,g=r.scrollYLoad,m=r.isAllOverflow,x=r.emptyRender,b=r.emptyOpts,h=r.mouseConfig,w=r.mouseOpts;if(!n||f.length||y||u&&p.isMerge||(v||g||(d?m:d))&&(c=o),a.empty)e=a.empty.call(this,{$table:r},t);else{var _=x?_vXETable.default.renderer.get(b.name):null;e=_&&_.renderEmpty?_.renderEmpty.call(this,t,b,{$table:r}):r.emptyText||_conf.default.i18n("vxe.table.emptyText")}return t("div",{class:["vxe-table--body-wrapper",n?"fixed-".concat(n,"--wrapper"):"body--wrapper"],attrs:{xid:i}},[n?l():t("div",{class:"vxe-body--x-space",ref:"xSpace"}),t("div",{class:"vxe-body--y-space",ref:"ySpace"}),t("table",{class:"vxe-table--body",attrs:{xid:i,cellspacing:0,cellpadding:0,border:0},ref:"table"},[t("colgroup",{ref:"colgroup"},c.map(function(e,l){return t("col",{attrs:{name:e.id},key:l})})),t("tbody",{ref:"tbody"},renderRows(t,this,r,"",0,n,s,c))]),t("div",{class:"vxe-table--checkbox-range"}),h&&w.area?t("div",{class:"vxe-table--cell-area"},[t("span",{class:"vxe-table--cell-main-area"},w.extension?[t("span",{class:"vxe-table--cell-main-area-btn",on:{mousedown:function(e){r.triggerCellExtendMousedownEvent(e,{$table:r,fixed:n,type:cellType})}}})]:null),t("span",{class:"vxe-table--cell-copy-area"}),t("span",{class:"vxe-table--cell-extend-area"}),t("span",{class:"vxe-table--cell-multi-area"}),t("span",{class:"vxe-table--cell-active-area"})]):null,n?null:t("div",{class:"vxe-table--empty-block",ref:"emptyBlock"},[t("div",{class:"vxe-table--empty-content"},e)])])},methods:{scrollEvent:function(e){var l=this.$el,t=this.$parent,r=this.fixedType,o=t.$refs,n=t.highlightHoverRow,a=t.scrollXLoad,i=t.scrollYLoad,s=t.lastScrollTop,c=t.lastScrollLeft,d=o.tableHeader,u=o.tableBody,p=o.leftBody,f=o.rightBody,y=o.tableFooter,v=o.validTip,g=d?d.$el:null,m=y?y.$el:null,x=u.$el,b=p?p.$el:null,h=f?f.$el:null,w=l.scrollTop,_=x.scrollLeft,T=_!==c,S=w!==s;t.lastScrollTop=w,t.lastScrollLeft=_,t.lastScrollTime=Date.now(),n&&t.clearHoverRow(),b&&"left"===r?syncBodyScroll(w=b.scrollTop,x,h):h&&"right"===r?syncBodyScroll(w=h.scrollTop,x,b):(T&&(g&&(g.scrollLeft=x.scrollLeft),m&&(m.scrollLeft=x.scrollLeft)),(b||h)&&(t.checkScrolling(),S&&syncBodyScroll(w,b,h))),a&&T&&t.triggerScrollXEvent(e),i&&S&&t.triggerScrollYEvent(e),T&&v&&v.visible&&v.updatePlacement(),t.emitEvent("scroll",{type:cellType,fixed:r,scrollTop:w,scrollLeft:_,isX:T,isY:S},e)}}};exports.default=_default;